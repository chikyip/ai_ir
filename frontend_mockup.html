<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IR Document Explorer - Mockup</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1 {
            margin: 0;
            font-size: 24px;
        }
        .filters {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        .result-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .result-image {
            width: 100%;
            height: 250px;
            background-color: #eee;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            border-bottom: 1px solid #eee;
        }
        .result-info {
            padding: 15px;
        }
        .result-meta {
            display: flex;
            justify-content: space-between;
            color: #777;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .result-title {
            font-weight: 600;
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        .result-content {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            font-size: 14px;
            max-height: 150px;
            overflow-y: auto;
        }
        .category-tag {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #777;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 5px;
        }
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .pagination button.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        /* New upload section styles */
        .upload-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .upload-container {
            border: 2px dashed #ddd;
            border-radius: 6px;
            padding: 30px;
            text-align: center;
            background-color: #f9f9f9;
            transition: all 0.3s;
        }
        
        .upload-container:hover {
            border-color: #3498db;
            background-color: #f0f7fc;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .upload-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .upload-subtitle {
            color: #777;
            margin-bottom: 20px;
        }
        
        .upload-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .upload-btn:hover {
            background-color: #2980b9;
        }
        
        .file-input {
            display: none;
        }
        
        .processing-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            background-color: #edf7ff;
            display: none;
        }
        
        .processing-status.active {
            display: block;
        }
        
        .status-progress {
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .status-bar {
            height: 100%;
            width: 0%;
            background-color: #3498db;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <header>
        <h1>IR Document Explorer</h1>
    </header>
    
    <div class="container">
        <!-- New Upload Section -->
        <div class="upload-section">
            <h2>Upload IR Documents</h2>
            <div class="upload-container">
                <div class="upload-icon">ðŸ“„</div>
                <div class="upload-title">Drag & Drop PDF Files Here</div>
                <div class="upload-subtitle">or</div>
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Browse Files</button>
                <input type="file" id="fileInput" class="file-input" accept=".pdf" multiple>
                
                <!-- Updated Client, Report Type, and Year Inputs for Upload -->
                <div style="margin-top: 20px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 15px; align-items: center;">
                    <div>
                        <label for="upload-client-input" style="display: block; margin-bottom: 5px; font-weight: 500; color: #555;">Client:</label>
                        <input type="text" id="upload-client-input" placeholder="e.g., MRCB" style="width: 100%; max-width: 250px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                    </div>
                    <div>
                        <label for="upload-report-type-input" style="display: block; margin-bottom: 5px; font-weight: 500; color: #555;">Report Type:</label>
                        <input type="text" id="upload-report-type-input" placeholder="e.g., Annual or Quarterly" style="width: 100%; max-width: 250px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                    </div>
                    <div>
                        <label for="upload-document-year" style="display: block; margin-bottom: 5px; font-weight: 500; color: #555;">Document Year:</label>
                        <input type="text" id="upload-document-year" placeholder="e.g., 2023" style="width: 100%; max-width: 250px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; text-align: center;">
                    </div>
                </div>

                <div class="processing-status" id="processingStatus">
                    <div id="statusText">Processing documents...</div>
                    <div class="status-progress">
                        <div class="status-bar" id="statusBar"></div>
                    </div>
                    <div id="statusDetails">Preparing files...</div>
                </div>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-group">
                <label for="client-filter">Client</label>
                <select id="client-filter">
                    <option value="MRCB">MRCB</option>
                    <option value="Maybank">Maybank</option>
                    <option value="Tenaga">Tenaga Nasional</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="report-type-filter">Report Type</label>
                <select id="report-type-filter">
                    <option value="annual">Annual Report</option>
                    <option value="quarterly">Quarterly Report</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Year</label>
                <div class="checkbox-group">
                    <label class="checkbox-label"><input type="checkbox" name="year" value="2023" checked> 2023</label>
                    <label class="checkbox-label"><input type="checkbox" name="year" value="2022"> 2022</label>
                    <label class="checkbox-label"><input type="checkbox" name="year" value="2021"> 2021</label>
                    <label class="checkbox-label"><input type="checkbox" name="year" value="2020"> 2020</label>
                </div>
            </div>
            
            <div class="filter-group">
                <label for="category-filter">Category</label>
                <select id="category-filter">
                    <option value="">All Categories</option>
                    <option value="financial_highlights">Financial Highlights</option>
                    <option value="income_statement">Income Statement</option>
                    <option value="chairman_statement">Chairman's Statement</option>
                    <option value="ceo_review">CEO's Review</option>
                    <option value="board_of_directors">Board of Directors</option>
                    <option value="md_and_a">Management Discussion & Analysis</option>
                </select>
            </div>
        </div>
        
        <!-- Category Pages JSON List Section -->
        <div id="category-pages" class="category-pages" style="display: none;">
            <h3>Pages Tagged with <span id="selected-category">Category</span></h3>
            <div class="pages-list-container">
                <div id="pages-list" class="pages-list"></div>
                <div id="json-preview-container" class="json-preview-container">
                    <div class="json-preview-header">
                        <h4>JSON Data (Full Info)</h4>
                        <button id="copy-json-btn" class="copy-btn">Copy JSON</button>
                    </div>
                    <pre id="json-preview" class="json-preview">Select a page to view JSON data</pre>

                    <div id="page-additional-details" style="margin-top: 20px; display: none;">
                        <h4>Page Summary</h4>
                        <p id="page-summary" class="page-detail-content">Select a page to view summary.</p>

                        <h4>Links</h4>
                        <ul id="page-links-list" class="page-links">
                            <li><a id="page-png-link" href="#" target="_blank" rel="noopener noreferrer">View PNG Image</a></li>
                            <li><a id="page-pdf-link" href="#" target="_blank" rel="noopener noreferrer">View Original PDF</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results section remains the same -->
    </div>
    
    <style>
        /* Existing styles remain the same */
        
        /* Checkbox styles */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            font-size: 14px;
            cursor: pointer;
        }
        
        .checkbox-label input {
            margin-right: 5px;
        }
        
        /* Updated category pages list styles */
        .pages-list-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }handleFiles
        
        .pages-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 10px;
        }
        
        .json-preview-container {
            flex: 2;
            display: flex;
            flex-direction: column;
        }
        
        .json-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .json-preview-header h4 {
            margin: 0;
        }
        
        .copy-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background-color: #2980b9;
        }
        
        .json-preview {
            background-color: #f5f7fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            height: 450px;
            overflow-y: auto;
            margin: 0;
        }
        
        .page-item {
            background-color: #f5f7fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .page-item:hover {
            background-color: #e9f0f8;
            border-color: #3498db;
        }
        
        .page-item.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .page-thumbnail {
            width: 30px;
            height: 30px;
            background-size: cover;
            background-position: center;
            margin-right: 8px;
            border-radius: 3px;
        }

        /* Styles for additional page details */
        #page-additional-details h4 {
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 16px;
            color: #2c3e50;
        }

        .page-detail-content {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
            white-space: pre-wrap; /* To respect newlines in summary */
        }

        .page-links {
            list-style: none;
            padding-left: 0;
        }

        .page-links li {
            margin-bottom: 5px;
        }

        .page-links a {
            color: #3498db;
            text-decoration: none;
        }

        .page-links a:hover {
            text-decoration: underline;
        }
    </style>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners to filters
            const selectFilters = document.querySelectorAll('select');
            selectFilters.forEach(filter => {
                filter.addEventListener('change', function() {
                    console.log('Filter changed:', this.id, this.value);
                    
                    if (this.id === 'category-filter') {
                        updateCategoryPagesList();
                    } else {
                        const selectedCategory = document.getElementById('category-filter').value;
                        if (selectedCategory) {
                            updateCategoryPagesList();
                        }
                    }
                });
            });
            
            // Add event listeners to checkbox filters
            const checkboxFilters = document.querySelectorAll('input[type="checkbox"]');
            checkboxFilters.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const selectedCategory = document.getElementById('category-filter').value;
                    if (selectedCategory) {
                        updateCategoryPagesList();
                    }
                });
            });
            
            // Copy JSON button
            const copyJsonBtn = document.getElementById('copy-json-btn');
            copyJsonBtn.addEventListener('click', function() {
                const jsonPreview = document.getElementById('json-preview');
                const textToCopy = jsonPreview.textContent;
                
                navigator.clipboard.writeText(textToCopy)
                    .then(() => {
                        // Change button text temporarily
                        const originalText = this.textContent;
                        this.textContent = 'Copied!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                    });
            });
            
            // File upload handling
            const uploadContainer = document.querySelector('.upload-container');
            const fileInput = document.getElementById('fileInput');
            const processingStatus = document.getElementById('processingStatus');
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            const statusDetails = document.getElementById('statusDetails');
            
            // Drag and drop events
            uploadContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadContainer.classList.add('active');
            });
            
            uploadContainer.addEventListener('dragleave', function() {
                uploadContainer.classList.remove('active');
            });
            
            uploadContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadContainer.classList.remove('active');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFiles(files);
                }
            });
            
            // File input change event
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    handleFiles(this.files);
                }
            });
            
            // Handle the uploaded files
            function handleFiles(files) {
                // Get client, report type, and year from dedicated upload text inputs
                const clientInput = document.getElementById('upload-client-input');
                const reportTypeInput = document.getElementById('upload-report-type-input');
                const documentYearInput = document.getElementById('upload-document-year');

                const selectedClient = clientInput.value.trim();
                const selectedReportType = reportTypeInput.value.trim();
                const selectedDocumentYear = documentYearInput.value.trim();

                // Validation for new inputs
                if (!selectedClient) {
                    alert("Please enter the Client for the upload.");
                    clientInput.focus();
                    fileInput.value = ""; // Clear the file input
                    return;
                }
                if (!selectedReportType) {
                    alert("Please enter the Report Type for the upload (e.g., Annual, Quarterly).");
                    reportTypeInput.focus();
                    fileInput.value = ""; // Clear the file input
                    return;
                }
                if (!selectedDocumentYear) {
                    alert("Please enter the Document Year for the upload.");
                    documentYearInput.focus();
                    fileInput.value = ""; // Clear the file input
                    return;
                }
                if (isNaN(selectedDocumentYear) || selectedDocumentYear.length !== 4) {
                    alert("Please enter a valid 4-digit year for the Document Year.");
                    documentYearInput.focus();
                    fileInput.value = ""; // Clear the file input
                    return; 
                }

                console.log("Files to upload:", files);
                console.log("Upload Context - Client:", selectedClient);
                console.log("Upload Context - Report Type:", selectedReportType);
                console.log("Upload Context - Document Year:", selectedDocumentYear);

                // Show processing status
                processingStatus.style.display = 'block';
                statusText.textContent = `Preparing ${files.length} document(s)...`;
                statusDetails.textContent = 'Initializing...';
                statusBar.style.width = '0%';
                
                // Simulate local preparation or initial processing steps
                let progress = 0;
                const preparationInterval = setInterval(function() {
                    progress += 20; // Faster simulation for preparation
                    statusBar.style.width = `${progress}%`;
                    
                    if (progress >= 100) {
                        clearInterval(preparationInterval);
                        statusText.textContent = 'Uploading to server...';
                        statusDetails.textContent = `Sending ${files.length} file(s).`;
                        statusBar.style.width = '100%'; // Indicate sending phase

                        // Actual backend call
                        const formData = new FormData();
                        for (const file of files) {
                            // 'pdf_files' is the field name your backend will expect for the files
                            formData.append('pdf_files', file, file.name); 
                        }
                        formData.append('client', selectedClient);
                        formData.append('report_type', selectedReportType);
                        formData.append('year', selectedDocumentYear);

                        fetch('/upload-and-process-pdfs', { // Replace with your actual backend endpoint
                            method: 'POST',
                            body: formData
                            // Headers are not explicitly set for FormData with fetch; 
                            // the browser sets 'Content-Type': 'multipart/form-data' automatically.
                        })
                        .then(response => {
                            if (!response.ok) {
                                // If server returns an error status (4xx, 5xx)
                                return response.json().then(errData => {
                                    throw new Error(errData.message || `Server error: ${response.status}`);
                                });
                            }
                            return response.json(); // Assuming server responds with JSON
                        })
                        .then(data => {
                            console.log('Backend processing response:', data);
                            statusText.textContent = 'Upload successful!';
                            statusDetails.textContent = data.message || `${files.length} document(s) successfully processed by the server.`;
                            // Optionally, trigger a refresh or update UI based on server response
                            // updateCategoryPagesList(); // If new data is available and needs to be shown

                            // Clear inputs after successful upload and server processing
                            setTimeout(function() {
                                processingStatus.style.display = 'none';
                                fileInput.value = ""; 
                                clientInput.value = ""; 
                                reportTypeInput.value = ""; 
                                documentYearInput.value = ""; 
                            }, 3000);
                        })
                        .catch(error => {
                            console.error('Error uploading files:', error);
                            statusText.textContent = 'Upload Failed!';
                            statusDetails.textContent = error.message || 'An error occurred during upload. Please try again.';
                            // Keep processing status visible to show the error
                            // Optionally, re-enable upload button or provide a retry mechanism
                        });
                    }
                }, 200); // Interval for preparation simulation
            }
            
            // Function to update the category pages list
            function updateCategoryPagesList() {
                const categoryPagesSection = document.getElementById('category-pages');
                const selectedCategorySpan = document.getElementById('selected-category');
                const pagesList = document.getElementById('pages-list');
                const jsonPreview = document.getElementById('json-preview');
                const pageAdditionalDetailsDiv = document.getElementById('page-additional-details');
                const pageSummaryP = document.getElementById('page-summary');
                const pagePngLinkA = document.getElementById('page-png-link');
                const pagePdfLinkA = document.getElementById('page-pdf-link');
                
                const selectedCategory = document.getElementById('category-filter').value;
                
                if (!selectedCategory) {
                    categoryPagesSection.style.display = 'none';
                    pageAdditionalDetailsDiv.style.display = 'none'; // Hide details if no category
                    return;
                }
                
                // Display the category name
                const categoryName = document.querySelector(`#category-filter option[value="${selectedCategory}"]`).textContent;
                selectedCategorySpan.textContent = categoryName;
                
                // Clear existing pages and reset details
                pagesList.innerHTML = '';
                jsonPreview.textContent = 'Select a page to view JSON data';
                pageSummaryP.textContent = 'Select a page to view summary.';
                pagePngLinkA.href = '#';
                pagePdfLinkA.href = '#';
                pageAdditionalDetailsDiv.style.display = 'none'; // Hide until a page is selected
                
                // Get selected years
                const selectedYears = Array.from(document.querySelectorAll('input[name="year"]:checked'))
                    .map(checkbox => checkbox.value);
                
                // Get other filter values
                const selectedClient = document.getElementById('client-filter').value;
                const selectedReportType = document.getElementById('report-type-filter').value;
                
                // Mock data - in a real implementation, this would come from an API
                // Added summary, pngLink, and pdfLink to mock data
                const mockPages = [
                    { 
                        id: 1, 
                        client: 'MRCB', 
                        report: 'Annual Report', 
                        year: '2023', 
                        page: 15, 
                        thumbnail: 'https://via.placeholder.com/30x30?text=15',
                        pngLink: 'https://via.placeholder.com/600x800.png?text=MRCB+2023+Page+15',
                        pdfLink: 'reports/MRCB_AR2023.pdf#page=15',
                        json: {
                            category: 'financial_highlights',
                            summary: 'MRCB showcased strong financial growth in 2023, with significant revenue increases and healthy profit margins. Key projects contributed to this success.',
                            content: {
                                revenue: 'RM 1.2 billion',
                                netProfit: 'RM 125 million',
                                eps: '2.8 sen',
                                dividend: '1.5 sen per share'
                            },
                            metadata: {
                                extracted_date: '2023-05-15',
                                confidence_score: 0.95
                            }
                        }
                    },
                    { 
                        id: 2, 
                        client: 'MRCB', 
                        report: 'Annual Report', 
                        year: '2022', 
                        page: 16, 
                        thumbnail: 'https://via.placeholder.com/30x30?text=16',
                        pngLink: 'https://via.placeholder.com/600x800.png?text=MRCB+2022+Page+16',
                        pdfLink: 'reports/MRCB_AR2022.pdf#page=16',
                        json: {
                            category: 'financial_highlights',
                            summary: 'Financial highlights for MRCB in 2022, reflecting steady performance amidst market challenges.',
                            content: {
                                revenue: 'RM 1.1 billion',
                                netProfit: 'RM 115 million',
                                eps: '2.5 sen',
                                dividend: '1.2 sen per share'
                            },
                            metadata: {
                                extracted_date: '2022-05-10',
                                confidence_score: 0.92
                            }
                        }
                    },
                    { 
                        id: 3, 
                        client: 'Maybank', 
                        report: 'Annual Report', 
                        year: '2023', 
                        page: 22, 
                        thumbnail: 'https://via.placeholder.com/30x30?text=22',
                        pngLink: 'https://via.placeholder.com/600x800.png?text=Maybank+2023+Page+22',
                        pdfLink: 'reports/Maybank_AR2023.pdf#page=22',
                        json: {
                            category: 'chairman_statement',
                            summary: "The Chairman's statement for Maybank's 2023 annual report, outlining strategic directions and achievements.",
                            content: {
                                title: "Chairman's Statement",
                                author: "Tan Sri Dato' Sri Zamzamzairani Mohd Isa",
                                highlights: [
                                    "Resilient performance amid challenging conditions",
                                    "Digital transformation acceleration",
                                    "Sustainability commitments"
                                ]
                            },
                            metadata: {
                                extracted_date: '2023-06-10',
                                confidence_score: 0.89
                            }
                        }
                    },
                    { 
                        id: 4, 
                        client: 'Tenaga', 
                        report: 'Annual Report', 
                        year: '2022', 
                        page: 42, 
                        thumbnail: 'https://via.placeholder.com/30x30?text=42',
                        pngLink: 'https://via.placeholder.com/600x800.png?text=Tenaga+2022+Page+42',
                        pdfLink: 'reports/Tenaga_AR2022.pdf#page=42',
                        json: {
                            category: 'board_of_directors',
                            summary: 'Details of Tenaga Nasional Berhad Board of Directors as of the 2022 annual report.',
                            content: {
                                members: [
                                    { name: "Dato' Sri Hasan Arifin", position: "Chairman", appointmentDate: "2020-10-01" },
                                    { name: "Datuk Ir. Baharin Din", position: "President/Chief Executive Officer", appointmentDate: "2021-03-01" }
                                ]
                            },
                            metadata: {
                                extracted_date: '2022-12-05',
                                confidence_score: 0.97
                            }
                        }
                    },
                    { 
                        id: 5, 
                        client: 'MRCB', 
                        report: 'Annual Report', 
                        year: '2023', 
                        page: 30, 
                        thumbnail: 'https://via.placeholder.com/30x30?text=30',
                        pngLink: 'https://via.placeholder.com/600x800.png?text=MRCB+2023+Page+30',
                        pdfLink: 'reports/MRCB_AR2023.pdf#page=30',
                        json: {
                            category: 'income_statement',
                            summary: 'MRCB Income Statement for the fiscal year 2023, detailing revenues, costs, and profits.',
                            content: {
                                revenue: 'RM 1,200,000,000', costOfSales: 'RM 950,000,000', grossProfit: 'RM 250,000,000',
                                operatingExpenses: 'RM 100,000,000', operatingProfit: 'RM 150,000,000', financeCosts: 'RM 25,000,000',
                                profitBeforeTax: 'RM 125,000,000', taxExpense: 'RM 30,000,000', netProfit: 'RM 95,000,000'
                            },
                            metadata: { extracted_date: '2023-05-15', confidence_score: 0.98 }
                        }
                    },
                    { 
                        id: 6, 
                        client: 'Maybank', 
                        report: 'Annual Report', 
                        year: '2022', 
                        page: 35, 
                        thumbnail: 'https://via.placeholder.com/30x30?text=35',
                        pngLink: 'https://via.placeholder.com/600x800.png?text=Maybank+2022+Page+35',
                        pdfLink: 'reports/Maybank_AR2022.pdf#page=35',
                        json: {
                            category: 'income_statement',
                            summary: "Maybank's detailed income statement for 2022, showing financial performance across various segments.",
                            content: {
                                revenue: 'RM 45,500,000,000', netInterestIncome: 'RM 15,100,000,000', operatingIncome: 'RM 22,300,000,000',
                                netProfit: 'RM 7,400,000,000'
                            },
                            metadata: { extracted_date: '2022-05-20', confidence_score: 0.96 }
                        }
                    }
                ];
                
                // Filter by selected category
                let filteredPages = mockPages.filter(page => page.json.category === selectedCategory);
                
                // Filter by selected years
                if (selectedYears.length > 0) {
                    filteredPages = filteredPages.filter(page => selectedYears.includes(page.year));
                }
                
                // Filter by selected client
                if (selectedClient) {
                    filteredPages = filteredPages.filter(page => page.client.toLowerCase() === selectedClient.toLowerCase());
                }
                
                // Filter by selected report type
                if (selectedReportType) {
                    filteredPages = filteredPages.filter(page => page.report.toLowerCase().includes(selectedReportType.toLowerCase()));
                }
                
                // Create page items
                filteredPages.forEach(page => {
                    const pageItem = document.createElement('div');
                    pageItem.className = 'page-item';
                    pageItem.dataset.id = page.id;
                    
                    const thumbnail = document.createElement('div');
                    thumbnail.className = 'page-thumbnail';
                    thumbnail.style.backgroundImage = `url('${page.thumbnail}')`;
                    
                    const pageInfo = document.createElement('span');
                    pageInfo.textContent = `${page.client} - ${page.report} ${page.year} (Page ${page.page})`;
                    
                    pageItem.appendChild(thumbnail);
                    pageItem.appendChild(pageInfo);
                    
                    // Add click event to show JSON data and additional details
                    pageItem.addEventListener('click', function() {
                        document.querySelectorAll('.page-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // Display the JSON data (Full Info)
                        const pageData = filteredPages.find(p => p.id == this.dataset.id);
                        if (pageData) {
                            // Show complete JSON in both sections
                            const fullJson = JSON.stringify(pageData.json, null, 2);
                            jsonPreview.textContent = fullJson;
                            pageSummaryP.textContent = fullJson;
                            
                            // Populate additional details
                            pagePngLinkA.href = pageData.pngLink || '#';
                            pagePngLinkA.textContent = pageData.pngLink ? 'View PNG Image' : 'PNG Link Not Available';
                            pagePdfLinkA.href = pageData.pdfLink || '#';
                            pagePdfLinkA.textContent = pageData.pdfLink ? 'View Original PDF' : 'PDF Link Not Available';
                            
                            pageAdditionalDetailsDiv.style.display = 'block';
                        } else {
                            jsonPreview.textContent = 'Error: Page data not found.';
                            pageAdditionalDetailsDiv.style.display = 'none';
                        }
                    });
                    
                    pagesList.appendChild(pageItem);
                });
                
                // Show the category pages section
                categoryPagesSection.style.display = 'block';
                
                // If no pages found, show a message and hide additional details
                if (filteredPages.length === 0) {
                    const noResults = document.createElement('div');
                    noResults.textContent = 'No pages found for the selected filters.';
                    noResults.style.padding = '10px';
                    noResults.style.color = '#777';
                    pagesList.appendChild(noResults);
                    pageAdditionalDetailsDiv.style.display = 'none'; // Hide details if no results
                }
            }
            
            // Initialize with the default category if one is selected
            const defaultCategory = document.getElementById('category-filter').value;
            if (defaultCategory) {
                updateCategoryPagesList();
            }
        });
    </script>
</body>
</html>